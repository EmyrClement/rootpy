#!/usr/bin/env python

import ROOT
from ROOT import TFile
from optparse import OptionParser
import sys

parser = OptionParser()
options,args = parser.parse_args()

if len(args) != 2: # TODO support multiple sources
    sys.exit(1)

target = args[-1]
sources = args[:-1]

targetFilename,targetTreename = target.split(":")

targetFile = TFile.Open(targetFilename,"update")

for source in sources:
    filename,treename = source.split(":")
    f = TFile.Open(filename)
    tree = f.Get(treename)
    if tree:
        targetFile.cd()
        newTree = tree.CloneTree(-1,"fast")
        newTree.SetName(targetTreename)
        newTree.Write("",ROOT.TObject.kOverwrite)
    else:
        print "%s not found in %s"%(treename,filename)
    f.Close()
targetFile.Close()
