language: python

python:
  - "2.7"

install:
  # This is needed for the docs
  - git submodule init
  - git submodule update

  # Use system python, not virtualenv, because building the dependencies from source takes too long
  - deactivate # the virtualenv
  - time sudo apt-get install -qq python-numpy python-matplotlib python-sphinx python-tables python-nose

  # Install a ROOT binary that we custom-built in a 32-bit Ubuntu VM
  - time wget https://github.com/downloads/cdeil/travis_test/root_v5.34.02.Linux-Ubuntu32-gcc4.6_v02.tar.gz
  - time tar zxf root_v5.34.02.Linux-Ubuntu32-gcc4.6_v02.tar.gz
  - source root_v5.34.02.Linux-Ubuntu32-gcc4.6/bin/thisroot.sh

  # We need to install or there will be ImportErrors when building the docs
  - python setup.py install --user

script:
  # Check if root and rootpy are properly installed
  - time root -l -q
  - time python -c 'import ROOT'
  - time python -c 'import rootpy'

  # Check that rootpy works correctly even if ROOT has already initialized
  - time python -c "from ROOT import kTRUE; import rootpy"

  # Now run the actual tests
  - time make test

  # Generate the docs
  - cd docs
  - time make html
  - cd ..
