#!/usr/bin/env python
import ROOT
import sys
from PyROOT.routines import getTrees
from optparse import OptionParser

parser = OptionParser()
options,args = parser.parse_args()

if len(args) != 2:
    sys.exit(1)
if args[0] == args[1]:
    sys.exit(1)

inFile = ROOT.TFile.Open(args[0])
outFile = ROOT.TFile.Open(args[1],"recreate")
outFile.cd()
trees = getTrees(inFile)
for tree in trees:
    print "optimizing %s..."%tree.GetName()
    newTree = tree.CloneTree(-1,"fast SortBasketsByEntry")
    newTree.OptimizeBaskets(10000000, 1.1, "d")
    newTree.Write("",ROOT.TObject.kOverwrite)
inFile.Close()
outFile.Close()
